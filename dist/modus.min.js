!function(t){var e=function(){if(Object.create)return function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t};var t=function(){};return function(e,n){t.prototype=n.prototype,e.prototype=new t,e.prototype.constructor=e,t.prototype=null}}(),n=function(t,e,n){if(n||(n=t),Array.prototype.forEach&&t.forEach)t.forEach(e,n);else if(t instanceof Array)for(var o=0;o<t.length;o+=1)e.call(n,t[o],o,t);else for(var r in t)t.hasOwnProperty(r)&&e.call(n,t[r],r,t);return t},o=function(t){return n(Array.prototype.slice.call(arguments,1),function(e){if(e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}),t},r=function(t,e){return Function.prototype.bind&&t.bind?t.bind(e):function(){t.apply(e,arguments)}},i=function(t){return"object"!=typeof t?t:t instanceof Array?t.slice():o({},t)},s={},a=function(t,e){for(var n=0,o=t.length-1;o>=0;o--){var r=t[o];"."===r?t.splice(o,1):".."===r?(t.splice(o,1),n++):n&&(t.splice(o,1),n--)}if(e)for(;n--;n)t.unshift("..");return t};s.resolve=function(){for(var t="",e=!1,n=arguments.length-1;n>=-1&&!e;n--){var o=n>=0?arguments[n]:"";o&&(t=o+"/"+t,e="/"===o.charAt(0))}return t=a(t.split("/").filter(function(t){return!!t}),!e).join("/"),(e?"/":"")+t||"."},s.normalize=function(t){for(var e=s.isAbsolute(t),n="/"===t[t.length-1],o=t.split("/"),r=[],i=0;i<o.length;i++)o[i]&&r.push(o[i]);return t=a(r,!e).join("/"),t||e||(t="."),t&&n&&(t+="/"),(e?"/":"")+t},s.isAbsolute=function(t){return"/"===t.charAt(0)},s.dirname=function(t){var e=t.substring(0,Math.max(t.lastIndexOf("/")));return e?e:"."};var u=function(){};u.prototype.addListener=function(t,e){return this._events||(this._events={}),this._events[t]||(this._events[t]=[]),this._events[t].push(e),this},u.prototype.once=function(t,e){var n=this,o=function(){n.removeListener(t,o),e.apply(this,arguments)};return this.addListener(t,o),this},u.prototype.on=u.prototype.addListener,u.prototype.removeListener=function(t,e){return this._events&&this._events[t]?e?(this._events[t].splice(this._events[t].indexOf(e),1),this):(delete this._events[t],this):this},u.prototype.emit=function(t){if(!this._events)return this;if(!this._events[t])return this;for(var e=Array.prototype.slice.call(arguments,1),n=0,o=this._events[t].length;o>n;n++)this._events[t][n].apply(this,e)};var c=function(){this._visited={}};c.prototype.getVisit=function(t){return this._visited[t]},c.prototype.addVisit=function(t){return this._visited[t]=!0,this},c.prototype.createScriptTag=function(t){var e=document.createElement("script");return e.type="text/javascript",e.charset="utf-8",e.async=!0,e.setAttribute("data-module",t),e.src=t+".js",e},c.prototype.insertScript=function(t,e){var n=document.getElementsByTagName("head")[0]||document.documentElement,o=!1;t.onload=t.onreadystatechange=function(){console.log("onLoad triggered"),o||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(o=!0,e(null,t.src),t.onload=t.onreadystatechange=null)},n.insertBefore(t,n.firstChild).parentNode},c.prototype.load=function(t,e){if(this.getVisit(t))return e(null,t),this;this.addVisit(t);var n=this.createScriptTag(t);return this.insertScript(n,e),this};var p={DISABLED:-1,PENDING:0,ENABLING:1,READY:2},h=function(e,n,o){this._modus=o||t.modus,this._dependencies=[],this._exports={},this._env={},this._state=p.PENDING,this.setName(e).setFactory(n)};e(h,u),h.prototype.setName=function(t){return t&&(t=s.normalize(t),this._name=s.isAbsolute(t)?t:s.resolve(t)),this},h.prototype.getName=function(){return this._name},h.prototype.getParentDir=function(){return s.resolve(this.getName(),"../")},h.prototype.setFactory=function(t){return this._factory=t,this},h.prototype.getFactory=function(){return this._factory},h.prototype.runFactory=function(t){var e=this.createEnv();return 2===this._factory.length?this._factory.call(e,e,t):(this._factory.call(e,e),t(null)),this};var l=[/\.from\(\s*["']([^'"\s]+)["']\s*\)/g,/\.imports\(\s*["']([^'"\s]+)["']\s*\)(?!\.from)/g],d=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm;h.prototype.findDependencies=function(){if(!this._factory)return this._dependencies;var t=this,e=this._factory.toString().replace(d,"");return n(l,function(n){e.replace(n,function(e,n){t.addDependency(n)})}),this._dependencies},h.prototype.addDependency=function(t){return this._dependencies.push(t),this},h.prototype.getDependencies=function(){return this._dependencies},h.prototype.getExports=function(){return i(this._exports)},h.prototype.createEnv=function(){return this._env.imports=this.createImporter(),this._env.exports=this.createExporter(),this._env},h.prototype.applyToEnv=function(t,e){var o=s.resolve(this.getParentDir(),e),r=this._modus.getModule(o);if(r){var i=r.getExports(),a=this;t instanceof Array?n(t,function(t){a._env[t]=i[t]}):a._env[t]=i["default"]||i}},h.prototype.createImporter=function(){var t=this;return function(){var e,n,o=Array.prototype.slice.call(arguments,0);if(o[0]instanceof Array&&(o=o[0]),1===o.length){var r=o[0];e=r.split("/").pop(),n=t._env[e],t.applyToEnv(e,r)}return{from:function(r){e&&(t._env[e]=n),console.log("Loading",r),t.applyToEnv(o,r)},as:function(o){e&&(t._env[e]=n),t.applyToEnv(o,r)}}}},h.prototype.createExporter=function(){var t=this;return function(e,n){return 1===arguments.length?t._exports["default"]=arguments[0]:t._exports[e]=n,{as:function(e){t._exports[e]=n}}}},h.prototype.enable=function(){if(this._state===p.READY)return void this.emit("ready");if(this._state===p.PENDING){var t=this,e=function(e){return e?(t._state=p.DISABLED,void t.emit("disabled")):(t._state=p.READY,void t.emit("ready"))},n=this.findDependencies();return n.length?(this._state=p.ENABLING,void this._modus.loadModules(this.getParentDir(),n,function(n){n||t.runFactory(e)})):(this._state=p.ENABLING,void this.runFactory(e))}};var f=function(t){this._config={"auto enable":!0,"root path":window?window.location.origin:""},this._modules={},this._loader=t||new c};e(f,u),f.prototype.config=function(t,e){var o=t;return"object"!=typeof t&&(o={},o[t]=e),n(o,function(t,e){this._config[e]=t},this),this},f.prototype.getConfig=function(t){return this._config[t]},f.prototype.createModule=function(t,e){e||(e=t,t=null);var n=new h(t,e,this);return console.log("creating",t),t&&this.addModule(n.getName(),n),this._config["auto enable"]&&t?n.enable():this._lastModule=n,n},f.prototype.addModule=function(t,e){return this._modules[t]=e,this},f.prototype.getModule=function(t){return this._modules[t]},f.prototype.getLastAddedModule=function(){var t=this._lastModule;return delete this._lastModule,t},f.prototype.loadModules=function(t,e,o){console.log("loading",e),o||(o=e,e=t,t=this.getConfig("root path")),t||(t=this.getConfig("root path")),e instanceof Array||(e=[e]);var r=e.length,i=this._loader,a=this,u=function(){r-=1,console.log(r),0>=r&&o(null)};n(e,function(e){var n=s.resolve(t,e),o=this.getModule(n);o?o.once("ready",u).enable():i.load(n,function(t,e){if(console.log(t,e),t)throw t;if(o=a.getModule(n),!o){if(o=a.getLastAddedModule(),!o)throw new Error("No module loaded for path "+n);o.setName(n),console.log("anon mod found",o.getName()),a.addModule(o.getName(),o)}o.once("ready",u).enable()})},this)},t.modus=new f,t.modus.VERSION="0.4.0";t.mod;t.mod=r(t.modus.createModule,t.modus),t.mod.noConflict=function(){var e=t.mod;return t.mod=_lastMod,e}}(this);